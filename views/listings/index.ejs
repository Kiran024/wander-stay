<% layout("/layouts/boilerplate") %>
<% const categories = [
  { icon: "fa-fire", label: "Trending" },
  { icon: "fa-bed", label: "Rooms" },
  { icon: "fa-mountain-city", label: "Iconic Cities" },
  { icon: "fa-mountain", label: "Mountains" },
  { icon: "fa-fort-awesome", label: "Castles" },
  { icon: "fa-person-swimming", label: "Amazing Pools" },
  { icon: "fa-campground", label: "Camping" },
  { icon: "fa-cow", label: "Farms" },
  { icon: "fa-snowflake", label: "Arctic" },
  { icon: "fa-igloo", label: "Domes" },
  { icon: "fa-ship", label: "Boats" },
]; %>

<% if (currUser) { %>
  <section id="filters">
    <% categories.forEach(({ icon, label }) => { %>
      <button type="button" class="filter">
        <div><i class="fa-solid <%= icon %>"></i></div>
        <p><%= label %></p>
      </button>
    <% }) %>
    <div class="tax-toggle">
      <label class="form-check form-switch align-items-center m-0 gap-2">
        <input class="form-check-input" type="checkbox" id="taxSwitch" />
        <span>Display total after taxes</span>
      </label>
    </div>
  </section>
<% } %>

<div class="row g-4">
  <% for (let listing of allListings) { %>
    <% const imageUrl = listing.image && listing.image.url ? listing.image.url : listing.image; %>
    <div class="col-12 col-sm-6 col-lg-4 d-flex align-items-stretch justify-content-center">
      <a href="/listings/<%= listing._id %>" class="listing-link d-flex w-100 h-100">
        <div class="card h-100 w-100">
          <img
            src="<%= imageUrl || 'https://via.placeholder.com/286x180?text=Listing' %>"
            class="card-img-top"
            alt="listing_image"
          />
          <div class="card-img-overlay">Lust</div>
          <div class="card-body">
            <p class="card-text">
              <b><%= listing.title %></b>
              <br />
              - &#8377; <%= listing.price.toLocaleString("en-IN") %> / night
              <i class="tax-info">&nbsp;&nbsp;+18% GST</i>
            </p>
          </div>
        </div>
      </a>
    </div>
  <% } %>
</div>

<script>
  const taxSwitch = document.getElementById("taxSwitch");
  if (taxSwitch) {
    taxSwitch.addEventListener("change", () => {
      const taxInfo = document.getElementsByClassName("tax-info");
      const displayValue = taxSwitch.checked ? "inline" : "none";
      for (const info of taxInfo) {
        info.style.display = displayValue;
      }
    });
  }
</script>
